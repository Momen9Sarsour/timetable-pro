<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إظهار/إخفاء قائمة منسدلة</title>
    <!-- Bootstrap CSS (RTL version) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <style>
        .filterable-select .dropdown-toggle::after {
            margin-left: 0;
            margin-right: auto;
        }
        .filterable-select .dropdown-menu {
            min-width: 100%;
        }
        .filterable-select .dropdown-item.d-none {
             display: none;
        }
        .dropdown-search-input {
            padding: 0.5rem 1rem;
        }
        #optionsListContainer {
            max-height: 200px;
            overflow-y: auto;
        }
        /* Style for the container holding select and close button */
        .select-wrapper {
            display: flex;
            align-items: flex-start; /* Align items at the top */
            gap: 0.5rem; /* Space between select and close button */
        }
        .select-wrapper .filterable-select {
            flex-grow: 1; /* Allow select to take available space */
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <h4>إظهار وإخفاء القائمة المنسدلة</h4>

    <!-- Button to show the select dropdown -->
    <button class="btn btn-primary mb-3" id="showSelectButton">إظهار القائمة المنسدلة</button>

    <!-- Wrapper for Select and Close Button (Initially Hidden) -->
    <div class="select-wrapper d-none" id="selectAreaWrapper">

        <!-- The Filterable Select Component -->
        <div class="dropdown filterable-select" id="filterableSelectContainer">
            <!-- Button trigger -->
            <button class="btn btn-outline-secondary dropdown-toggle w-100 d-flex justify-content-between align-items-center"
                    type="button"
                    id="filterableSelectButton"
                    data-bs-toggle="dropdown"
                    aria-expanded="false">
                <span id="selectedOptionText">اختر عنصر...</span>
            </button>

            <!-- Dropdown menu -->
            <ul class="dropdown-menu w-100" aria-labelledby="filterableSelectButton">
                <!-- Search Input -->
                <li class="dropdown-search-input">
                    <input type="search"
                           class="form-control form-control-sm"
                           id="selectSearchInput"
                           placeholder="بحث..."
                           aria-label="بحث في الخيارات"
                           autocomplete="off">
                </li>
                <li><hr class="dropdown-divider"></li>
                <!-- Options List Container -->
                <div id="optionsListContainer">
                    <li><a class="dropdown-item filterable-option" href="#" data-value="1">واحد</a></li>
                    <li><a class="dropdown-item filterable-option" href="#" data-value="2">اثنان</a></li>
                    <li><a class="dropdown-item filterable-option" href="#" data-value="3">ثلاثة</a></li>
                    <li><a class="dropdown-item filterable-option" href="#" data-value="4">أربعة</a></li>
                    <li><a class="dropdown-item filterable-option" href="#" data-value="5">خمسة</a></li>
                </div>
                <!-- No results message (hidden initially) -->
                <li><span class="dropdown-item text-muted d-none" id="noResultsMessage">لا توجد نتائج</span></li>
            </ul>
        </div>

        <!-- Close Button (Initially part of the hidden wrapper) -->
        <button class="btn btn-danger btn-sm" id="closeSelectButton" aria-label="إغلاق القائمة">
            × <!-- Simple 'X' icon -->
        </button>

    </div> <!-- End of selectAreaWrapper -->

    <!-- Optional: Hidden input for form submission -->
    <input type="hidden" name="selectedValue" id="selectedValueInput">

</div>

<!-- Bootstrap Bundle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // References
        const showButton = document.getElementById('showSelectButton');
        const closeButton = document.getElementById('closeSelectButton');
        const selectAreaWrapper = document.getElementById('selectAreaWrapper'); // The new wrapper
        const searchInput = document.getElementById('selectSearchInput');
        const optionsContainer = document.getElementById('optionsListContainer');
        const selectedOptionText = document.getElementById('selectedOptionText');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const hiddenValueInput = document.getElementById('selectedValueInput');
        const dropdownButton = document.getElementById('filterableSelectButton');
        const defaultSelectText = "اختر عنصر..."; // Store default text

        // --- Show Select Logic ---
        showButton.addEventListener('click', function() {
            showButton.classList.add('d-none');         // Hide Show button
            selectAreaWrapper.classList.remove('d-none'); // Show the wrapper (contains select and close button)
        });

        // --- Close Select Logic ---
        closeButton.addEventListener('click', function() {
            selectAreaWrapper.classList.add('d-none');  // Hide the wrapper
            showButton.classList.remove('d-none');      // Show the Show button again

            // Reset the select state
            selectedOptionText.textContent = defaultSelectText;
            hiddenValueInput.value = '';
            searchInput.value = '';
             // Make all options visible again if they were filtered
            optionsContainer.querySelectorAll('li').forEach(li => li.classList.remove('d-none'));
            noResultsMessage.classList.add('d-none'); // Hide no results message

            // Close the dropdown if it's open
            const dropdownInstance = bootstrap.Dropdown.getInstance(dropdownButton);
            if (dropdownInstance) {
                dropdownInstance.hide();
            }
        });

        // --- Auto-Focus on Search Input ---
        dropdownButton.addEventListener('shown.bs.dropdown', function () {
            setTimeout(() => { searchInput.focus(); }, 10);
        });

        // --- Filtering Logic ---
        searchInput.addEventListener('keyup', function () {
            const filter = searchInput.value.toLowerCase();
            let resultsFound = false;
            const currentOptions = optionsContainer.querySelectorAll('.filterable-option');
            currentOptions.forEach(option => {
                const text = option.textContent.toLowerCase();
                const listItem = option.parentElement;
                const match = text.includes(filter);
                listItem.classList.toggle('d-none', !match);
                if (match) resultsFound = true;
            });
            noResultsMessage.classList.toggle('d-none', resultsFound);
        });

        // --- Option Selection Logic ---
        optionsContainer.addEventListener('click', function(event) {
            if (event.target.classList.contains('filterable-option')) {
                event.preventDefault();
                selectedOptionText.textContent = event.target.textContent;
                hiddenValueInput.value = event.target.getAttribute('data-value');
                const dropdownInstance = bootstrap.Dropdown.getInstance(dropdownButton);
                if (dropdownInstance) dropdownInstance.hide();
                searchInput.value = '';
                searchInput.dispatchEvent(new Event('keyup'));
            }
        });

        // --- Prevent dropdown close on search click ---
        searchInput.addEventListener('click', event => event.stopPropagation());
    });
</script>

</body>
</html>
